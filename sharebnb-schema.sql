CREATE TABLE users (
  username VARCHAR(25) PRIMARY KEY,
  password TEXT NOT NULL,
  first_name TEXT NOT NULL,
  last_name TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL
    CHECK (position('@' IN email) > 1),
  is_host BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE properties (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title TEXT UNIQUE NOT NULL,
  host_username VARCHAR(25) NOT NULL
    REFERENCES users ON DELETE CASCADE,
  image TEXT UNIQUE NOT NULL,
  price_night INTEGER NOT NULL,
  description TEXT NOT NULL,
  address TEXT UNIQUE NOT NULL
);

CREATE TABLE bookings (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  guest_username VARCHAR(25) NOT NULL
    REFERENCES users ON DELETE CASCADE,
  property_id INTEGER NOT NULL
    REFERENCES properties ON DELETE CASCADE,
  date_booked DATE DEFAULT CURRENT_DATE,
  checkin_date DATE NOT NULL,
  checkout_date DATE NOT NULL
);

CREATE TABLE messages (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  sender_username VARCHAR(25) NOT NULL
    REFERENCES users ON DELETE CASCADE,
  receiver_username VARCHAR(25) NOT NULL
    REFERENCES users ON DELETE CASCADE,
  content TEXT NOT NULL
);